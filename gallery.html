<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å…°æ˜Ÿå°‘å¹´ä¿±ä¹éƒ¨ Â· ç…§ç‰‡å®‡å®™</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --lanxing-blue: #1f5fff;
      --lanxing-dark: #020617;
      --lanxing-light: #f5f7ff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-soft: #e5e7eb;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4ff;
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .container {
      max-width: 1120px;
      margin: 0 auto;
      padding: 0 16px;
    }

    /* é¡¶éƒ¨å¯¼èˆª */
    header {
      padding: 14px 0;
      background: #ffffffcc;
      border-bottom: 1px solid rgba(229, 231, 235, 0.9);
      backdrop-filter: blur(14px);
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 14px;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
    }

    .nav-logo {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #a5b4fc, #1d4ed8);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #f9fafb;
      font-size: 16px;
      font-weight: 800;
    }

    .nav a {
      color: #4b5563;
      text-decoration: none;
    }

    .nav a:hover {
      color: #111827;
    }

    main {
      flex: 1;
      padding: 28px 0 32px;
    }

    /* ä¸ŠåŠéƒ¨åˆ†ç®€ä»‹å¡ç‰‡ */

    .intro-card {
      background: #fff;
      border-radius: 18px;
      border: 1px solid var(--border-soft);
      padding: 22px 22px 20px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.08);
      margin-bottom: 20px;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 4px;
    }

    .subtitle-small {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .notice {
      border-radius: 12px;
      border: 1px dashed #cbd5f5;
      background: var(--lanxing-light);
      padding: 10px 12px;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .notice a {
      color: var(--lanxing-blue);
      text-decoration: none;
    }
    .notice a:hover {
      text-decoration: underline;
    }

    /* ===================================
       å®‡å®™èƒŒæ™¯å®¹å™¨ + æ˜Ÿç©º + æµæ˜Ÿ
       =================================== */

    /* å®‡å®™èƒŒæ™¯ + æ˜Ÿäº‘ */
    .universe-bg {
      position: relative;
      width: 100%;
      min-height: 1200px;
      overflow: hidden;
      background:
        radial-gradient(circle at 20% 0%, #3b5fc4 0, #151b3a 40%, #050818 100%);
    }

    .universe-bg::before {
      content: "";
      position: absolute;
      inset: -20%;
      pointer-events: none;
      z-index: 0;
      background:
        radial-gradient(circle at 18% 32%, rgba(120, 150, 255, 0.25) 0, transparent 55%),
        radial-gradient(circle at 82% 72%, rgba(190, 120, 255, 0.22) 0, transparent 60%),
        radial-gradient(circle at 60% 10%, rgba(255, 255, 255, 0.15) 0, transparent 40%);
      mix-blend-mode: screen;
      opacity: 0.9;
    }

    /* æ˜Ÿç©ºå±‚ï¼Œå¤šå±‚éšæœºæ˜Ÿæ˜Ÿ */
    .stars {
      position: absolute;
      inset: -40%;
      pointer-events: none;
      z-index: 1;
    }

    .stars::before,
    .stars::after {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(rgba(255,255,255,0.95) 1px, transparent 1px),
        radial-gradient(rgba(255,255,255,0.6) 1.5px, transparent 1.5px),
        radial-gradient(rgba(255,255,255,0.35) 2px, transparent 2px);
      background-size:
        190px 210px,
        280px 260px,
        420px 430px;
      background-position:
        0 0,
        80px 50px,
        -70px 130px;
      opacity: 0.45;
      animation: twinkle 9s infinite alternate ease-in-out;
      mix-blend-mode: screen;
    }

    .stars::after {
      background-position:
        -120px -40px,
        120px 160px,
        -40px 260px;
      opacity: 0.35;
      animation-duration: 13s;
    }

    @keyframes twinkle {
      0% {
        opacity: 0.25;
        transform: translate3d(0, 0, 0);
      }
      50% {
        opacity: 0.7;
        transform: translate3d(8px, -6px, 0);
      }
      100% {
        opacity: 0.35;
        transform: translate3d(-5px, 4px, 0);
      }
    }

    /* æµæ˜Ÿå±‚ */
    .shooting-star {
      position: absolute;
      inset: -10%;
      pointer-events: none;
      z-index: 3;
      overflow: hidden;
    }

    @keyframes meteor {
      0% {
        opacity: 0;
        transform: translate(0,0) rotate(-45deg);
      }
      5% {
        opacity: 1;
      }
      20% {
        opacity: 0;
        transform: translate(350px, 350px) rotate(-45deg);
      }
      100% {
        opacity: 0;
      }
    }

    /* æµ®åŠ¨ç…§ç‰‡å®‡å®™ä¸»å®¹å™¨ */

    .floating-wrapper {
      margin-top: 8px;
      padding-bottom: 8px;
      position: relative;
      z-index: 2;
    }

    .floating-wall {
      position: relative;
      width: 100%;
      height: 1080px;
      border-radius: 22px;
      background: radial-gradient(circle at top,
                  rgba(255,255,255,0.22) 0,
                  rgba(243,244,255,0.16) 38%,
                  rgba(15,23,42,0.55) 100%);
      box-shadow: 0 26px 60px rgba(15, 23, 42, 0.18);
      overflow: hidden;
    }

    /* å•å¼ ç…§ç‰‡å¡ç‰‡ */

    .photo-card,
    .photo-stack {
      position: absolute;
      cursor: pointer;
      transition:
        transform 0.25s ease-out,
        box-shadow 0.25s ease-out,
        filter 0.25s ease-out;
    }

    .photo-card-inner {
      position: relative;
      width: 190px;
      height: 125px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.25);
      background: #000;
      transform-style: preserve-3d;
      transform-origin: center center;
    }

    .photo-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      backface-visibility: hidden;
    }

    .photo-card:hover,
    .photo-stack:hover {
      transform: translate3d(0, -4px, 0) scale(1.03) rotate(var(--rot));
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.3);
      filter: brightness(1.05);
    }

    /* èƒŒé¢å¡ç‰Œ */

    .photo-card.is-back .front-face {
      display: none;
    }

    .photo-card.is-back .back-face {
      display: flex;
    }

    .back-face {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 0, #ffffff 0, #1e293b 48%, #020617 100%);
      color: #e5e7eb;
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0.8rem;
      font-size: 0.8rem;
      backface-visibility: hidden;
    }

    .back-face span {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      opacity: 0.9;
    }

    /* å †å å¡ç‰Œ */

    .photo-stack-inner {
      position: relative;
      width: 200px;
      height: 135px;
    }

    .stack-card {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.25);
      background: #000;
      transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
    }

    .stack-card:nth-child(1) {
      transform: translate(-10px, -10px) rotate(-5deg);
      z-index: 1;
    }
    .stack-card:nth-child(2) {
      transform: translate(0, 0) rotate(1deg);
      z-index: 2;
    }
    .stack-card:nth-child(3) {
      transform: translate(10px, 8px) rotate(6deg);
      z-index: 3;
    }

    .photo-stack:hover .stack-card:nth-child(1) {
      transform: translate(-18px, -16px) rotate(-8deg);
    }
    .photo-stack:hover .stack-card:nth-child(3) {
      transform: translate(18px, 16px) rotate(9deg);
    }

    .stack-label {
      position: absolute;
      top: -26px;
      left: 0;
      background: rgba(255, 255, 255, 0.9);
      color: #111827;
      border-radius: 999px;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      backdrop-filter: blur(8px);
      pointer-events: none;
    }

    /* ====== æ–°ç‰ˆç…§ç‰‡å¤§å›¾æ¨¡æ€æ¡†ï¼ˆå®Œç¾é€‚é…æ‰‹æœº + PCï¼‰ ====== */
.photo-modal {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.88);
  display: none;
  align-items: center;
  justify-content: center;
  padding: 16px;
  z-index: 2000;
}

.photo-modal.visible {
  display: flex;
}

.photo-modal-inner {
  max-width: 100%;
  max-height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

/* å¤§å›¾ï¼šè‡ªåŠ¨åœ¨å±å¹•å†…æŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼Œä¸ä¼šè¢«è£åˆ‡ï¼Œä¹Ÿä¸ä¼šè¶…å‡ºå±å¹• */
.photo-modal-inner img {
  max-width: 100vw;
  max-height: calc(100vh - 140px);
  width: auto;
  height: auto;
  object-fit: contain;
  border-radius: 12px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.65);
}

/* å¤§å›¾ç¼–å· */
.photo-modal-header {
  color: #e5e7eb;
  font-size: 14px;
}

/* å…³é—­æŒ‰é’® */
.photo-modal-close {
  margin-top: 8px;
  padding: 6px 14px;
  border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.6);
  background: rgba(15, 23, 42, 0.9);
  color: #e5e7eb;
  font-size: 13px;
}

/* è¯„è®ºè¾“å…¥åŒºï¼ˆä¿ç•™ä½ åŸæ¥çš„ç»“æ„ï¼‰ */
.comment-box textarea {
  width: 100%;
  min-height: 80px;
  resize: vertical;
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid #64748b;
  background: rgba(255,255,255,0.08);
  color: #e2e8f0;
}

.comment-box button {
  margin-top: 6px;
  padding: 6px 14px;
  font-size: 14px;
  border-radius: 999px;
  border: none;
  background: #2563eb;
  color: #fff;
}


    /* åº•éƒ¨å¯¼èˆª */

    .footer-nav {
      margin-top: 8px;
      padding: 18px 0 10px;
      border-top: 1px solid rgba(229, 231, 235, 0.8);
      display: flex;
      justify-content: center;
      gap: 28px;
      font-size: 14px;
      background: #f9fafb;
    }

    .footer-nav a {
      color: #4b5563;
      text-decoration: none;
    }

    .footer-nav a:hover {
      color: #111827;
      text-decoration: underline;
    }

    footer {
      padding: 8px 0 18px;
      font-size: 12px;
      color: #9ca3af;
      text-align: center;
      background: #f9fafb;
    }

    @media (max-width: 960px) {
      .floating-wall {
        height: 900px;
      }
    }

    @media (max-width: 720px) {
      .floating-wall {
        height: 820px;
      }

      .photo-card-inner {
        width: 160px;
        height: 110px;
      }

      .photo-stack-inner {
        width: 170px;
        height: 120px;
      }

      .modal-inner {
        grid-template-columns: minmax(0, 1fr);
        max-height: 92vh;
      }

      .modal-image-wrap {
        max-height: 50vh;
      }
    }
  </style>
</head>
<body>
<header>
  <div class="container nav">
    <div class="nav-left">
      <div class="nav-logo">L</div>
      <div>å…°æ˜Ÿå°‘å¹´ä¿±ä¹éƒ¨ Â· ç…§ç‰‡å®‡å®™</div>
    </div>
    <a href="index.html">è¿”å›é¦–é¡µ</a>
  </div>
</header>

<main>
  <div class="container">
    <div class="intro-card">
      <h1>å…°æ˜Ÿå°‘å¹´ Â· ç…§ç‰‡å®‡å®™</h1>
      <p class="subtitle-small">
        å¦‚æœæŸå¼ ç…§ç‰‡è®©ä½ æƒ³èµ·æœ‰è¶£çš„æ•…äº‹ã€æ¯”èµ›çš„é‚£ä¸€ç§’ã€æŸä¸ªå­©å­çš„é—ªå…‰ç‚¹ï¼Œ
        æ¬¢è¿åœ¨ç…§ç‰‡ä¸‹æ–¹ç•™è¨€ï¼Œä¸€èµ·æŠŠè¿™ç‰‡ç…§ç‰‡å®‡å®™â€œè£…ä¿®â€å¾—æ›´çƒ­é—¹ã€æ›´æœ‰æ¸©åº¦ã€‚
      </p>

      <div class="notice">
        <p style="margin-bottom: 4px;"><strong>ğŸ“Œ æ¸©é¦¨æç¤ºï¼ˆä¸­æ–‡ï¼‰</strong><br>
          å¦‚æœä½ å‘ç°æŸå¼ ç…§ç‰‡ä¸é€‚åˆå…¬å¼€å±•ç¤ºï¼Œè¯·é‚®ä»¶è”ç³»æˆ‘ä»¬ï¼š
          <a href="mailto:blastjunior@163.com">blastjunior@163.com</a>ï¼Œ
          æˆ‘ä»¬ä¼šå°½å¿«å¤„ç†å¹¶ä¸‹æ¶ã€‚
        </p>

        <p style="margin-bottom: 4px;"><strong>ğŸ“Œ Friendly Notice (English)</strong><br>
          If you find a photo that you believe should not be displayed, please contact us at
          <a href="mailto:blastjunior@163.com">blastjunior@163.com</a>.
          We will review and remove it as soon as possible.
        </p>

        <p style="margin-bottom: 4px;"><strong>ğŸ“Œ ã”é€£çµ¡ãã ã•ã„ï¼ˆæ—¥æœ¬èªï¼‰</strong><br>
          å…¬é–‹ã«ä¸é©åˆ‡ã¨æ€ã‚ã‚Œã‚‹å†™çœŸãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€
          <a href="mailto:blastjunior@163.com">blastjunior@163.com</a> ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚
          ç¢ºèªå¾Œã€é€Ÿã‚„ã‹ã«å‰Šé™¤ã„ãŸã—ã¾ã™ã€‚
        </p>

        <p style="margin-bottom: 0;"><strong>ğŸ“Œ ì•ˆë‚´ë¬¸ (í•œêµ­ì–´)</strong><br>
          ê³µê°œë˜ê¸° ì–´ë ¤ìš´ ì‚¬ì§„ì„ ë°œê²¬í•˜ì‹œë©´
          <a href="mailto:blastjunior@163.com">blastjunior@163.com</a> ìœ¼ë¡œ ì—°ë½ì£¼ì„¸ìš”.
          í™•ì¸ í›„ ì‹ ì†íˆ ì‚­ì œí•˜ê² ìŠµë‹ˆë‹¤.
        </p>
      </div>
    </div>

    <div class="universe-bg">
      <div class="stars"></div>
      <div class="shooting-star"></div>

      <div class="floating-wrapper">
        <div class="floating-wall" id="floatingWall">
          <!-- JS ä¼šåœ¨è¿™é‡Œç”Ÿæˆéšæœºæ•£è½ / å †å çš„ç…§ç‰‡ -->
        </div>
      </div>
    </div>
  </div>
</main>

<div class="footer-nav">
  <a href="index.html">é¦–é¡µ</a>
  <a href="honor.html">è£èª‰å®¤</a>
  <a href="gallery.html">ç…§ç‰‡å¢™</a>
  <a href="news.html">æ–°é—»ä¸­å¿ƒ</a>
</div>

<footer>
  Â© <script>document.write(new Date().getFullYear())</script> å…°æ˜Ÿå°‘å¹´ä¿±ä¹éƒ¨ Â· Photo Wall
</footer>

<!-- ç…§ç‰‡å®‡å®™è„šæœ¬ï¼ˆç¼©ç•¥å›¾ + å»¶è¿ŸåŠ è½½åŸå›¾ï¼‰ -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  // ====== åŸºæœ¬ DOM å¼•ç”¨å’Œå¸¸é‡ ======
  const wall = document.getElementById("floatingWall");
  if (!wall) return;

  const IMAGE_BASE = "/images";        // åŸå›¾ç›®å½•
  const THUMB_BASE = "/images/thumbs"; // ç¼©ç•¥å›¾ç›®å½•
  const MIN_SINGLES = 30;              // è‡³å°‘å¤šå°‘å¼ ç…§ç‰‡ä½œä¸ºæ•£è½å•å¼ 

    // æ¨¡æ€æ¡†ç›¸å…³
  function openModal(photo) {
    const img = document.getElementById("modalImage");
    const idSpan = document.getElementById("modalPhotoId");
    const modal = document.getElementById("photoModal");

    if (!img || !idSpan || !modal) return;

    // é”ä½èƒŒæ™¯æ»šåŠ¨ï¼Œé˜²æ­¢æ‰‹æœºä¸Šå¼¹å‡ºæ—¶é¡µé¢ä¹±è·‘
    document.body.dataset.prevOverflow = document.body.style.overflow || "";
    document.body.style.overflow = "hidden";

    // é‡ç½®æ»šåŠ¨æ¡åˆ°é¡¶éƒ¨ï¼Œç¡®ä¿æ•´å¼ å¤§å›¾åœ¨è§†é‡é‡Œ
    window.scrollTo(0, 0);

    img.src = ""; // å…ˆæ¸…ç©ºä¸Šä¸€å¼ 
    idSpan.textContent = `#${String(photo.id).padStart(3, "0")}`;
    modal.classList.add("visible");

    // çœŸæ­£åŠ è½½åŸå›¾ï¼ˆè¿™é‡Œæ‰æ¶ˆè€—å¸¦å®½ï¼‰
    img.src = photo.full;
  }

  function closeModal() {
    const modal = document.getElementById("photoModal");
    const img = document.getElementById("modalImage");
    if (modal) modal.classList.remove("visible");
    if (img) img.src = "";

    // æ¢å¤èƒŒæ™¯æ»šåŠ¨
    if (document.body.dataset.prevOverflow !== undefined) {
      document.body.style.overflow = document.body.dataset.prevOverflow;
    } else {
      document.body.style.overflow = "";
    }

    const textarea = document.getElementById("commentText");
    if (textarea) textarea.value = "";
  }
  window.closeModal = closeModal;


  // ====== éšæœºåˆ†ç»„ï¼šå“ªäº›åš STACKï¼Œå“ªäº›åšå•å¼  ======
  function makeGroups(shuffled) {
    const stacks = [];
    const singles = [];
    const pool = shuffled.slice();
    const total = pool.length;

    if (total <= MIN_SINGLES) {
      while (pool.length > 0) singles.push(pool.shift());
      return { stacks, singles };
    }

    while (pool.length > 0) {
      const remaining = pool.length;
      const singlesNeeded = Math.max(0, MIN_SINGLES - singles.length);
      const maxStackable = remaining - singlesNeeded;

      if (maxStackable < 2) {
        singles.push(pool.shift());
        continue;
      }

      const r = Math.random();
      if (r < 0.30) {
        // åˆ›å»ºä¸€ä¸ªå †å ï¼šè‡³å°‘ 2 å¼ ï¼Œæ²¡æœ‰ç¡¬æ€§ä¸Šé™
        const stackSize = 2 + Math.floor(Math.random() * (maxStackable - 1)); // [2, maxStackable)
        const group = pool.splice(0, stackSize);
        stacks.push(group);
      } else {
        singles.push(pool.shift());
      }
    }
    return { stacks, singles };
  }

  // ====== éšæœºä½ç½® / è§’åº¦ ======
  function randomPlacement(el) {
    const top = 8 + Math.random() * 84;
    const left = 8 + Math.random() * 84;
    const rot = (Math.random() * 26 - 13).toFixed(1);
    const scale = 0.85 + Math.random() * 0.3;

    el.style.top = top + "%";
    el.style.left = left + "%";
    el.style.transform = `translate(-50%, -50%) rotate(${rot}deg) scale(${scale})`;
    el.style.setProperty("--rot", `${rot}deg`);
  }

  // ====== æ‡’åŠ è½½ï¼šè¿›å…¥è§†å£é™„è¿‘æ‰åŠ è½½ç¼©ç•¥å›¾ ======
  const lazyObserver = new IntersectionObserver(
    (entries, observer) => {
      entries.forEach(entry => {
        if (!entry.isIntersecting) return;
        const host = entry.target;
        const img = host.querySelector("img[data-src]");
        if (img && !img.src) {
          img.src = img.dataset.src; // è¿™é‡Œæ‰çœŸæ­£åŠ è½½ç¼©ç•¥å›¾
        }
        observer.unobserve(host);
      });
    },
    {
      root: null,
      rootMargin: "200px", // æå‰ä¸€ç‚¹åŠ è½½
      threshold: 0.1
    }
  );

  // ====== æ¸²æŸ“å•å¼ ç…§ç‰‡ï¼ˆåªæŒ‚ç¼©ç•¥å›¾ï¼Œå¹¶æ‡’åŠ è½½ï¼‰ ======
  function renderSinglePhoto(photo) {
    const card = document.createElement("div");
    card.className = "photo-card";
    card.dataset.photoId = photo.id;

    const inner = document.createElement("div");
    inner.className = "photo-card-inner";

    const frontImg = document.createElement("img");
    frontImg.className = "front-face";
    frontImg.alt = `Photo ${photo.id}`;
    frontImg.loading = "lazy";
    frontImg.dataset.src = photo.thumb; // æ‡’åŠ è½½ç”¨ data-src

    const back = document.createElement("div");
    back.className = "back-face";
    back.innerHTML = "<span>CLICK TO FLIP</span>";

    inner.appendChild(frontImg);
    inner.appendChild(back);
    card.appendChild(inner);

    // æœ‰ä¸€éƒ¨åˆ†é»˜è®¤æ˜¯â€œèƒŒé¢æœä¸Šâ€
    if (Math.random() < 0.25) {
      card.classList.add("is-back");
    }

    // âœ… æ‰‹æœº & ç”µè„‘ï¼šä¸€æ¬¡ç‚¹å‡»å°±ç¿»é¢ + æ‰“å¼€å¤§å›¾
    card.addEventListener("click", () => {
      if (card.classList.contains("is-back")) {
        card.classList.remove("is-back");
      }
      openModal(photo);
    });

    randomPlacement(card);
    wall.appendChild(card);

    lazyObserver.observe(card);
  }

  // ====== æ¸²æŸ“å †å ï¼šåªåŠ è½½ 1 å¼ é¢„è§ˆç¼©ç•¥å›¾ï¼Œå…¶ä»–åªæ˜¯æ•°æ® ======
  function renderStack(group, stackIndex) {
    const stack = document.createElement("div");
    stack.className = "photo-stack";
    stack.dataset.stackIndex = stackIndex;

    const inner = document.createElement("div");
    inner.className = "photo-stack-inner";

    const preview = group[Math.floor(Math.random() * group.length)];

    const cardBottom = document.createElement("div");
    cardBottom.className = "stack-card";
    cardBottom.style.background =
      "linear-gradient(135deg, #0f172a, #020617)";

    const cardMid = document.createElement("div");
    cardMid.className = "stack-card";
    cardMid.style.background =
      "linear-gradient(135deg, #1f2937, #020617)";

    const cardTop = document.createElement("div");
    cardTop.className = "stack-card";

    const img = document.createElement("img");
    img.alt = `Stack preview ${preview.id}`;
    img.loading = "lazy";
    img.dataset.src = preview.thumb;
    cardTop.appendChild(img);

    inner.appendChild(cardBottom);
    inner.appendChild(cardMid);
    inner.appendChild(cardTop);

    const size = group.length;
    const label = document.createElement("div");
    label.className = "stack-label";
    label.textContent = `STACK Â· ${size}`;

    const baseFont = 11;
    const font = baseFont + Math.min(size * 0.18, 7);
    label.style.fontSize = font + "px";
    const padY = 2 + Math.min(size * 0.06, 4);
    const padX = 6 + Math.min(size * 0.1, 6);
    label.style.padding = `${padY}px ${padX}px`;

    stack.appendChild(inner);
    stack.appendChild(label);

    // æŠ½ç­¾ï¼šè¿™é‡Œæ‰ä¼šç”¨åˆ°æ•´ç»„ groupï¼ˆä½†åªå¤§å›¾åŠ è½½ï¼‰
    stack.addEventListener("click", () => {
      const max = group.length;
      const input = prompt(
        `This stack holds ${max} photos.\n` +
        `Enter a number between 1 and ${max} to draw one:`
      );
      if (input === null) return;

      const n = parseInt(input, 10);
      if (Number.isNaN(n) || n < 1 || n > max) {
        alert(`Please enter a number between 1 and ${max}.`);
        return;
      }

      const picked = group[n - 1];
      openModal(picked);
    });

    randomPlacement(stack);
    wall.appendChild(stack);

    lazyObserver.observe(stack);
  }

  // ====== è¯»å– list.jsonï¼Œç”Ÿæˆâ€œå…ƒæ•°æ®å®‡å®™â€ ======
  fetch("/images/list.json")
    .then((r) => r.json())
    .then((files) => {
      const photos = files.map((name, index) => ({
        id: index + 1,
        name,
        thumb: `${THUMB_BASE}/${name}`,
        full: `${IMAGE_BASE}/${name}`,
      }));

      const shuffled = photos.sort(() => Math.random() - 0.5);
      const { stacks, singles } = makeGroups(shuffled);

      stacks.forEach((group, i) => renderStack(group, i));
      singles.forEach((photo) => renderSinglePhoto(photo));
    })
    .catch((err) => {
      console.error("åŠ è½½ /images/list.json å¤±è´¥ï¼š", err);
    });

  // ====== æµæ˜Ÿæ•ˆæœ ======
  function launchMeteor() {
    const starLayer = document.querySelector(".shooting-star");
    if (!starLayer) return;

    const node = document.createElement("div");
    node.classList.add("meteor-beam");
    node.style.position = "absolute";

    const startX = Math.random() * window.innerWidth * 0.8;
    node.style.top = Math.random() * 200 + "px";
    node.style.left = startX + "px";

    node.style.width = "2px";
    node.style.height = "160px";
    node.style.background =
      "linear-gradient(white, rgba(255,255,255,0))";
    node.style.transform = "rotate(-45deg)";
    node.style.opacity = "0";
    node.style.animation = "meteor 1.8s ease-in-out forwards";

    starLayer.appendChild(node);
    setTimeout(() => starLayer.removeChild(node), 2000);

    const next = Math.random() * 15000 + 5000;
    setTimeout(launchMeteor, next);
  }
  setTimeout(launchMeteor, 3000);
});
</script>


<!-- æ¨¡æ€æ¡† -->
<div class="modal" id="photoModal">
  <div class="modal-inner">
    <div class="modal-image-wrap">
      <img id="modalImage" src="" alt="Photo preview" />
      <button class="modal-close" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-info">
      <div>
        <div class="modal-meta-label">Photo</div>
        <div class="modal-photo-id" id="modalPhotoId"></div>
      </div>
      <div>
        <div class="modal-meta-label">Notes</div>
        <p id="modalPlaceholderText">
          è¿™æ˜¯å…°æ˜Ÿå°‘å¹´ä¿±ä¹éƒ¨çš„ä¸€ä¸ªç¬é—´ã€‚æœªæ¥è¿™é‡Œä¼šæ˜¾ç¤ºå·²å®¡æ ¸é€šè¿‡çš„ç•™è¨€èŠ‚é€‰ã€‚
        </p>
      </div>
      <div class="comment-box">
        <div class="modal-meta-label">Leave a message</div>
        <textarea id="commentText" placeholder="Write a short message about this photo..."></textarea>
        <button id="commentSubmitBtn"
                onclick="alert('ç›®å‰ä¸ºæ¼”ç¤ºç‰ˆï¼Œæœªæ¥ä¼šæ¥å…¥ Cloudflare Worker è¿›è¡Œç•™è¨€å®¡æ ¸ä¸ä¿å­˜ã€‚');">
          Send (demo)
        </button>
        <div class="comment-hint">
          Demo ç‰ˆæœ¬ï¼šæš‚æ—¶ä¸ä¼šçœŸæ­£ä¿å­˜ç•™è¨€ã€‚æ­£å¼ç‰ˆä¼šé€šè¿‡ Cloudflare KV å­˜å‚¨å¹¶äººå·¥å®¡æ ¸åå±•ç¤ºã€‚
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
