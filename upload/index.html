<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>照片上传 - 兰星少年俱乐部</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"PingFang SC","Microsoft YaHei",sans-serif;margin:22px;max-width:760px}
    .card{border:1px solid #eee;border-radius:14px;padding:16px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    input[type="file"]{border:1px dashed #bbb;border-radius:10px;padding:14px;width:100%}
    input[type="password"]{padding:10px 12px;border:1px solid #ddd;border-radius:10px;min-width:280px}
    button{padding:10px 14px;border-radius:10px;border:1px solid #2b6cb0;background:#fff;cursor:pointer}
    pre{background:#0b1020;color:#e7e7e7;padding:12px;border-radius:12px;overflow:auto}
    .small{color:#666;font-size:12px}
  </style>
</head>
<body>
  <h2>照片上传（进入审核队列）</h2>
  <div class="card">
    <p class="small">当前版本：需要管理员口令（ADMIN_TOKEN）才能上传。后续我们可以改成公开上传 + Turnstile 防刷。</p>
    <div class="row" style="margin:10px 0">
      <label>管理员口令：</label>
      <input id="token" type="password" placeholder="粘贴 ADMIN_TOKEN" />
    </div>

    <input id="file" type="file" accept="image/jpeg,image/png,image/webp" />
    <div class="row" style="margin-top:12px">
      <button onclick="doUpload()">上传到待审核</button>
      <a href="/admin" class="small">去后台审核 →</a>
    </div>

    <p id="msg" class="small"></p>
    <pre id="out"></pre>
  </div>

<script>
async function doUpload(){
  const token = document.getElementById("token").value.trim();
  const f = document.getElementById("file").files[0];
  const msg = document.getElementById("msg");
  const out = document.getElementById("out");
  msg.textContent = "";
  out.textContent = "";

  if (!token){ msg.textContent = "请先填写 ADMIN_TOKEN"; return; }
  if (!f){ msg.textContent = "请先选择图片文件"; return; }

  const fd = new FormData();
  fd.append("file", f);

  msg.textContent = "上传中...";
  const res = await fetch("/media/upload", {
    method: "POST",
    headers: { "Authorization": "Bearer " + token },
    body: fd
  });

  const data = await res.json().catch(()=>null);
  if (!res.ok){
    msg.textContent = "上传失败";
    out.textContent = JSON.stringify(data || {error:"unknown"}, null, 2);
    return;
  }
  msg.textContent = "上传成功（已进入待审核）";
  out.textContent = JSON.stringify(data, null, 2);
}
</script>
</body>
</html>
